---
title: "broadband"
author: "Christoph Potempa"
date: "15.05.2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Load some packages

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(tidytuesdayR)
library(scales)
library(tidycensus)
library(readxl)
```

### Get the data

```{r echo=FALSE, warning=FALSE, message=FALSE}
broadband <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-05-11/broadband.csv')
broadband_zip  <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-05-11/broadband_zip.csv')
```

### Cleaning the Data

```{r}
broadband_county <- broadband %>% 
  janitor::clean_names() %>% 
  rename (state = st) %>% 
  mutate(state = state.name[match(state, state.abb)])

broadband_zip <- broadband_zip %>% 
  janitor::clean_names() %>% 
  rename(state = st) %>% 
  view()
  
```

### Loading in Census Population Data

```{r warning=FALSE, message=FALSE}
county_population <- read_excel("co-est2019-annres.xlsx", skip = 3) %>% 
  select(county =...1, population_2017 =`2017`) %>% 
  separate(county, c("county_name", "state"), sep =", ") %>% 
  mutate(county_name = str_remove(county_name, "."))
```

### Join population data with broadband data

```{r warning=FALSE, message=FALSE}
broadband_with_population <- broadband_county %>% 
  inner_join(county_population, by = c("county_name")) 

broadband_with_population %>% 
  arrange(desc(population_2017)) %>% 
  head(25) %>% 
ggplot(aes(population_2017, county_name)) +
  geom_col()
```



